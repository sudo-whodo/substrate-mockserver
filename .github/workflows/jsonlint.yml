name: JSON Lint

on:
  pull_request:
    types: [ opened, synchronize, reopened ]
    paths:
      - '**/*.json'
  push:
    paths:
      - '**/*.json'
  workflow_dispatch:

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Validate JSON files
        run: |
          echo "Validating JSON files..."
          echo "# JSON Validation Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          exit_code=0
          file_count=0
          valid_count=0

          for file in mocks/*.json; do
            if [ -f "$file" ]; then
              file_count=$((file_count + 1))
              echo "Checking $file..."
              if python -m json.tool "$file" > /dev/null 2>&1; then
                echo "✅ $file is valid JSON"
                echo "✅ \`$file\` - Valid JSON" >> $GITHUB_STEP_SUMMARY
                valid_count=$((valid_count + 1))
              else
                echo "❌ $file is invalid JSON"
                echo "❌ \`$file\` - Invalid JSON" >> $GITHUB_STEP_SUMMARY
                exit_code=1
              fi
            fi
          done

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## Summary" >> $GITHUB_STEP_SUMMARY
          echo "- **Total files checked:** $file_count" >> $GITHUB_STEP_SUMMARY
          echo "- **Valid files:** $valid_count" >> $GITHUB_STEP_SUMMARY
          echo "- **Invalid files:** $((file_count - valid_count))" >> $GITHUB_STEP_SUMMARY

          if [ $exit_code -eq 0 ]; then
            echo "✅ All JSON files are valid!"
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "🎉 **All JSON files are valid!**" >> $GITHUB_STEP_SUMMARY
          else
            echo "❌ One or more JSON files are invalid"
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "❌ **One or more JSON files are invalid**" >> $GITHUB_STEP_SUMMARY
            exit 1
          fi
